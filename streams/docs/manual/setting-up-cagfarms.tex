\section{Setting up the Farm}

\subsection{Introduction}
The CAG group has a bunch of Linux machines where StreamIt development
occurs on. You can probably set up a local development environment but
that is your own problem. The machines are named {\tt
cagfarm-01.lcs.mit.edu} to {\tt cagfarm-49.lcs.mit.edu}. For StreamIt
development, it is probably best to use numbers 27-49, as these are
fast dual-processor machines.  Next best are cagfarms 11-26, which are
slower dual-processor machines.  Cagfarms 01-10 are used for a
job-queueing system.

All the cagfarm's are accessible via ssh and they run X so you can
forward X packets and run an X server on your local machine if you so
desire. Most of the file systems on the cagfarms are remote mounted
via NFS so your home directory and most other directories of interest
are always the same.

\subsection{Setting up Environment Variables}
There are two environment variables that you absolutely need to set up
in order to checkout and compile the StreamIt compiler\footnote{If you
  lose this document, the latest bare-bones guide to getting started
  with StreamIt is maintained in {\tt
    /home\slash{}streamit\slash{}cag-streamit.txt} on the CAG
  machines.}. It is probably a good idea to use your {\tt .cshrc} or
{\tt .bashrc} files to set the values each time you log in. Unless you
change it, your account on the cagfarm will use {\tt csh} for your
shell, and so you should edit the {\tt .cshrc} file to do things each
login.

\paragraph{CVSROOT}
This environment variable tells cvs where the root repository is 
located. To work on StreamIt, you should set it to 
{\tt /projects/raw/cvsroot}.

\paragraph{STREAMIT\_HOME}
This should be set to path of the {\tt streams} directory that 
you check out of CVS. It is used by various scripts and programs
to find out the StreamIt installation path.

\paragraph{CLASSPATH}
Back in the day, you had to set up your class path manually.  Now
there are two files which will do it for you, depending on your choice
of shell. Since they both live in the CVS repository, you first need
to check out the {\tt streams} project, as described in
Section~\ref{sec:checkout}. Then you can use {\tt
streams/include/dot-cshrc} by putting the following command in your
{\tt .cscrc}
\begin{verbatim}
source ${STREAMIT_HOME}/include/dot-cshrc
\end{verbatim}

\noindent or by putting the following command in your {\tt .bashrc}

\begin{verbatim}
. $STREAMIT_HOME/include/dot-bashrc
\end{verbatim}

\subsubsection{Example section of {\tt .cshrc}}
\begin{verbatim}
## Set up class path (by using the classpath in include/dot-cshrc)
setenv STREAMIT_HOME $HOME/streams
source ${STREAMIT_HOME}/include/dot-cshrc

## cvsroot for streams stuff
setenv CVSROOT /projects/raw/cvsroot
\end{verbatim}



\subsection{Checking out the {\tt streams} Repository}
\label{sec:checkout}
Once you have set up the {\tt CVSROOT} environment variable
you need to check out the StreamIt source tree. All of the
StreamIt code gets checked out into a new directory named
{\tt streams}, so your home directory is fine for this purpose.
Go to your chosen directory and run {\tt cvs co streams} which
will check out all of the StreamIt files, documentation, etc.
There are several hundred megabytes of files, so the checkout 
will take several minutes.


\subsection{Eclipse}
There is a graphical IDE that you can use to work on the compiler
called Eclipse\footnote{Emacs, however, is the bomb.}. You can
probably use other IDEs too, but we know how to set up Eclipse.
Here's how to set up eclipse:
\begin{enumerate}

\item There is a shared copy of eclipse in:

\noindent {\tt /home/bits7/NO\_BACKUP/streamit/eclipse-2.1.0}

This is the release build from November.  To run it with your own
workspace, issue this command from the above directory:

\noindent {\tt ./eclipse -data \~{}/workspace}

We've found that you actually have to be in the eclipse directory when
you give this command, otherwise it dies.  Also if you try to run
without the -data flag, it will die (since you won't have permissions
on the default workspace directory.)

If you'd prefer to run a more recent and/or less stable build of
eclipse, please put it in 

\noindent {\tt /home/bits7/NO\_BACKUP/streamit} 

\noindent and notify the group so that we can share.

\item Checkout streams and run make (following directions later in
 this document).  I don't know how to make eclipse use antlr to
 generate stuff yet.)

\item Click New Project, Java, Java Project, Next.

\item Name the project ``streamit'', uncheck ``use default'' and give
the value of your {\tt \$STREAMIT\_HOME} for the directory.  Click
next.

\item On dialog, click NO for constructing project directory
automatically.

\item Add folder, ``compiler''.  On dialog about bin directory, say
``Yes''.

\item Add folder ``eclipse''.

\item Add folder ``compiler/3rdparty''.

\item Add folder, ``library/java''.

\item Select exclusion filter under compiler/3rdparty, edit it, and
add ``cplex'' as an excluded directory.

\item 

Go to Libraries tab, say ``add external Jars'', and add two:
\begin{enumerate}

\item {\tt /usr/uns/java/antlr.jar}

\item {\tt \$STREAMIT\_HOME/compiler/3rdparty/cplex/cplex.jar} (not
  literally -- substitute {\tt \$STREAMIT\_HOME} with its value on
  your setup).

\end{enumerate}
Somehow this tab seems to be finicky -- first set the filter to the
directory you're interested in, then use the mouse to double-click the
jar file.  Otherwise for some reason it referenced a non-existent file
for me.

\item Click finish.

\end{enumerate}

Everything should compile -- you'll get hundreds of ``problems'' but
these should all be warnings (yellow flags instead of red ones).
There might even be some red flags that are okay for classes that are
not needed by the main compiler (e.g., in the misc directory).  Then
you're all set and can run/debug, etc... e.g. go to Run/Debug... and
set up a test case.

\subsection{RT}
We use a trouble ticketing system called RT. This is (at least
in theory) the centralized location for both reporting bugs and 
keeping the rest of the group updated on their fixes.
You can access RT at {\tt https://cag.lcs.mit.edu/rt/}. There are at least
salient features of the above address: first the {\bf s} in {\tt https}
and second the trailing slash on {\tt rt/}. These are both
required. The RT system will prompt you for a username and password
both of which are the same as your CAG unix accounts. 
You will need to have your account ``activated'' for use on 
RT, and you should write one of us to figure that out.

\subsection{Useful Things Andrew would have Liked to Know}

\paragraph{fu2}
For some reason, the command to use to find an unused cagfarm machine
is called {\tt fu2}. It generates output something like this:
\begin{verbatim}
cagfarm-01: 2:14pm up 6 days, 50 min, 5 users, load average: 1.00, 1.03, 1.00
...
cagfarm-40: 2:14pm up 10 days, 22:33, 1 user, load average: 0.00, 0.00, 0.00
cagfarm-41: 2:14pm up 50 days, 15:51, 6 users, load average: 0.00, 0.00, 0.00
cagfarm-42: 2:14pm up 50 days, 15:50, 1 user, load average: 0.06, 0.07, 0.01
cagfarm-43: 2:14pm up 50 days, 15:51, 6 users, load average: 0.91, 0.53, 0.25
cagfarm-44: 2:14pm up 10 days, 22:33, 1 user, load average: 0.00, 0.00, 0.00
cagfarm-45: 2:14pm up 5 days, 2:30, 0 users, load average: 0.00, 0.01, 0.15
cagfarm-46: 2:14pm up 50 days, 15:51, 3 users, load average: 0.01, 0.00, 0.00
cagfarm-47: 2:14pm up 50 days, 15:51, 1 user, load average: 1.00, 1.04, 1.00
cagfarm-48: 2:14pm up 50 days, 15:51, 4 users, load average: 0.00, 0.03, 0.00
cagfarm-49: 2:14pm up 50 days, 15:51, 1 user, load average: 0.00, 0.00, 0.00
\end{verbatim}

\paragraph{cagload}

You can also use {\tt /home/streamit/tools/cagload} to get a sorted
list of the load on cagfarm machines.

\paragraph{dot}
\label{sec:dot}
{\tt dot} is a useful graph making tool. You can convert {\tt .dot}
files into {\tt .ps} files by using the command {\tt dot -Tps
  filename.dot > filename.ps}, and then view the resulting file by
running {\tt gv filename.ps}.

\paragraph{.forward}
Mail typically gets sent to you at your account at {\tt cag.lcs.mit.edu}. 
You probably want to
at least look at it. To get mail sent to {\tt username@cag.lcs.mit.edu}
forwarded to some other account, make a file called {\tt .forward}
in your home directory with a single line that contains the email address
to forward to (for example, {\tt username@mit.edu}).

\paragraph{Default Permissions}
The default permissions for everyone's files in their home directories
is world readable. Therefore, if you have any configuration questions 
you can look at how someone else has done things in their config files.
It is also useful sometimes to copy a file from someones
CVS directory if they forget to checkin a file or two with their
latest modification.

\paragraph{Homepage}
If you want to have files available via the web on the cagfarms, make
a directory called {\tt public\_html} in your home directory. The contents
of this directory are available at the website
\begin{verbatim}
http://cag.lcs.mit.edu/~username
\end{verbatim}
 where (obviously) {\tt username} is your username.

\paragraph{Filesystems}
There are several filesystems for use if you need to store large
files.  {\tt /home/bits6/} and {\tt home/bits7} are good locations.
They are automounted, so to use one, you should go to {\tt
  home/bits6}, make a directory for your usename, and just go wild.
If you're not storing sensitive data, use the {\tt
  /home/bits6\slash{}NO\_BACKUP} or {\tt /home/bits7/NO\_BACKUP}
directory to help with storage space.

\paragraph{Access via Windows}
If you want access to the cag filesystems via windows
(which is very convenient) you can use
\begin{verbatim}
\\cag-server\cag\u\username
\end{verbatim}
to get at your home directory and 
\begin{verbatim}
\\cag-server\cag\home\bits6
\end{verbatim}
 to get at {\tt home/bits6}, etc.

